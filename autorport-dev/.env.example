# ==========================================
# AutoReportAI 开发环境配置文件
# 使用说明：
# 1. 复制此文件为 .env: cp .env.example .env
# 2. 运行: ./start.sh 选择启动模式
# ==========================================

# ==========================================
# 基础环境设置
# ==========================================
NODE_ENV=development
DEBUG=true
PROJECT_NAME=AutoReportAI

# ==========================================
# 服务端口配置 - 局域网访问支持
# ==========================================
# 注意: SERVER_IP 会在运行时自动检测并替换为本机IP
# 如需强制指定IP，可以设置为具体的IP地址
SERVER_IP=localhost
PORT=8000
FRONTEND_PORT=3000

# ==========================================
# 局域网访问配置
# ==========================================
# 这些变量会被start.sh自动配置
NEXT_PUBLIC_API_URL=http://${SERVER_IP}:8000/api/v1
NEXT_PUBLIC_WS_URL=ws://${SERVER_IP}:8000/ws
NEXT_PUBLIC_ENABLE_LAN_ACCESS=true

# ==========================================
# 数据库配置
# ==========================================
POSTGRES_USER=postgres
POSTGRES_PASSWORD=CHANGE_ME_TO_STRONG_DB_PASSWORD
POSTGRES_DB=autoreport
DATABASE_URL=postgresql://${POSTGRES_USER}:${POSTGRES_PASSWORD}@db:5432/${POSTGRES_DB}

# ==========================================
# Redis配置
# ==========================================
REDIS_HOST=redis
REDIS_PORT=6380
REDIS_URL=redis://redis:6380/0

# ==========================================
# 安全配置
# ==========================================
SECRET_KEY=CHANGE_ME_TO_STRONG_RANDOM_SECRET
ACCESS_TOKEN_EXPIRE_MINUTES=60
ENCRYPTION_KEY=CHANGE_ME_TO_STRONG_RANDOM_ENCRYPTION_KEY

# ==========================================
# Celery任务队列配置
# 注意: Celery Beat 已被 APScheduler 取代，调度信息存储在数据库中
# 以下配置仍用于 Celery Worker 执行异步任务
# ==========================================
CELERY_BROKER_URL=redis://redis:6380/1
CELERY_RESULT_BACKEND=redis://redis:6380/1
CELERY_TIMEZONE=Asia/Shanghai

# ==========================================
# 时区配置
# ==========================================
TZ=Asia/Shanghai

# ==========================================
# 前端配置 (支持局域网访问)
# ==========================================
# 启动脚本会自动替换为实际IP地址
NEXT_PUBLIC_API_URL=http://localhost:8000/api/v1
NEXT_PUBLIC_WS_URL=ws://localhost:8000/ws
NEXT_TELEMETRY_DISABLED=1

# ==========================================
# 邮件服务配置 (可选)
# ==========================================
SMTP_SERVER=smtp.gmail.com
SMTP_PORT=587
SMTP_USERNAME=your-email@example.com
SMTP_PASSWORD=your-app-password
EMAILS_FROM_EMAIL=noreply@autoreportai.com

# ==========================================
# 通知设置
# ==========================================
ENABLE_EMAIL_NOTIFICATIONS=false
ENABLE_WEBSOCKET_NOTIFICATIONS=true

# ==========================================
# DDD架构配置
# ==========================================
# DDD架构启用
DDD_ARCHITECTURE_ENABLED=true
APPLICATION_SERVICE_LAYER=enabled
DOMAIN_SERVICE_LAYER=enabled
INFRASTRUCTURE_SERVICE_LAYER=enabled
UNIFIED_API_RESPONSE=enabled
TRANSACTIONAL_APPLICATION_SERVICE=enabled

# Agent系统配置 - 基础设施层
AGENT_ENGINE=new
NEW_AGENT_MODE=local_stub
NEW_AGENT_TIMEOUT=60
NEW_AGENT_MAX_CONCURRENCY=10
NEW_AGENT_MAX_RETRIES=3

# 🆕 Agent上下文管理配置 - ResourcePool 精简记忆模式
# true: 使用ResourcePool模式（轻量级ContextMemory，减少token使用，提高SQL生成稳定性）
# false: 使用传统模式（完整schema累积传递）
ENABLE_CONTEXT_CURATION=true

# ==========================================
# LLM服务配置 (可选)
# ==========================================
# LLM配置 - 如需使用AI功能，请配置相应的API密钥
DEFAULT_LLM_PROVIDER=openai
LLM_TEMPERATURE=0.1
LLM_MAX_TOKENS=4096

# ==========================================
# 存储和缓存配置
# ==========================================
# 文件存储
UPLOAD_PATH=./data/backend/uploads
MAX_UPLOAD_SIZE=100MB
ALLOWED_FILE_TYPES=pdf,doc,docx,xls,xlsx,csv,txt,json

# 缓存配置
CACHE_SYSTEM_ENABLED=true
CACHE_DEFAULT_TTL=3600

# WebSocket配置
WEBSOCKET_ENABLED=true

# ==========================================
# Minio对象存储配置
# ==========================================
MINIO_ROOT_USER=minioadmin
MINIO_ROOT_PASSWORD=CHANGE_ME_TO_STRONG_MINIO_PASSWORD
MINIO_BUCKET_NAME=autoreport
MINIO_API_PORT=9000
MINIO_CONSOLE_PORT=9001

# ==========================================
# 日志配置
# ==========================================
LOG_LEVEL=DEBUG
ENABLE_PERFORMANCE_MONITORING=true

# ==========================================
# MinIO 访问密钥配置 - 用于 Backend 和 Worker 服务
# ⚠️ 重要说明：
# .env 文件不支持变量替换（如 ${MINIO_ROOT_USER}），需要直接设置实际值
# docker-compose.yml 中的 ${MINIO_ROOT_USER:?...} 会自动从 .env 文件读取并映射
# 
# 推荐方式：在 .env 文件中设置与 MINIO_ROOT_USER/MINIO_ROOT_PASSWORD 相同的值
# 这样既满足 docker-compose 的需求，也满足应用代码直接读取的需求
MINIO_ACCESS_KEY=minioadmin
MINIO_SECRET_KEY=CHANGE_ME_TO_STRONG_MINIO_PASSWORD
RATE_LIMIT_WINDOW=60

# ==========================================
# 默认用户配置
# ==========================================
FIRST_SUPERUSER=admin
FIRST_SUPERUSER_EMAIL=admin@autoreportai.com
FIRST_SUPERUSER_PASSWORD=CHANGE_ME_TO_STRONG_ADMIN_PASSWORD

# ==========================================
# 生产环境提醒
# ==========================================
# 生产环境部署时请务必：
# 1. 更改所有默认密钥和密码
# 2. 配置HTTPS和强密码策略
# 3. 设置适当的CORS设置
# 4. 配置LLM API密钥
# 5. 启用监控和日志