'use client'

import * as React from 'react'
import { createContext, useContext, useState, ReactNode } from 'react'

// 简化的翻译数据
const translations = {
  'zh-CN': {
    common: {
      loading: '加载中...',
      error: '错误',
      success: '成功',
      cancel: '取消',
      confirm: '确认',
      save: '保存',
      delete: '删除',
      edit: '编辑',
      add: '添加',
      search: '搜索',
      refresh: '刷新',
      back: '返回',
      next: '下一步',
      previous: '上一步',
      submit: '提交',
      reset: '重置',
      close: '关闭',
      open: '打开',
      yes: '是',
      no: '否',
      ok: '确定',
      navigation: '导航',
      mainNavigation: '主导航',
      collapseSidebar: '收起侧边栏',
      expandSidebar: '展开侧边栏',
      closeSidebar: '关闭侧边栏',
      openSidebar: '打开侧边栏',
      dragToResize: '拖拽调整大小',
      notifications: '通知',
    },
    dashboard: {
      title: '仪表板概览',
      description: '欢迎回来！以下是您的报告生成情况。',
      totalReports: '总报告数',
      dataSources: '数据源',
      templates: '模板',
      activeTasks: '活跃任务',
      createTask: '创建任务',
      recentActivity: '最近活动',
      systemStatus: '系统状态',
      backendService: '后端服务正常',
      aiService: 'AI服务正常',
      databaseConnection: '数据库连接正常',
    },
    auth: {
      login: '登录',
      register: '注册',
      logout: '退出登录',
      username: '用户名',
      password: '密码',
      email: '邮箱',
      forgotPassword: '忘记密码？',
      rememberMe: '记住我',
      loginButton: '登录',
      registerButton: '注册',
      loginFailed: '登录失败',
      invalidCredentials: '用户名或密码错误',
      loggingIn: '登录中...',
      title: '登录到 AutoReportAI',
      description: '请输入您的凭据以继续',
      usernamePlaceholder: '请输入用户名',
      passwordPlaceholder: '请输入密码',
      noAccount: '还没有账户？',
      signUp: '立即注册',
      devHint: '开发环境提示',
      defaultCredentials: '默认用户名: admin, 密码: admin123',
    },
    dataSources: {
      title: '数据源管理',
      addDataSource: '添加数据源',
      name: '名称',
      type: '类型',
      configuration: '配置',
      actions: '操作',
      test: '测试',
      preview: '预览',
      edit: '编辑',
      delete: '删除',
      noDataSources: '暂无数据源',
      createFirstDataSource: '创建第一个数据源',
      createDataSource: '新增数据源',
      dataSourceName: '数据源名称',
      dataSourceNamePlaceholder: '请输入数据源名称',
      dataSourceType: '数据源类型',
      database: '数据库',
      api: 'API',
      file: '文件',
      databaseUrl: '数据库URL',
      databaseUrlPlaceholder: '请输入数据库连接URL',
      apiUrl: 'API地址',
      apiUrlPlaceholder: '请输入API地址',
      filePath: '文件路径',
      filePathPlaceholder: '请输入文件路径',
      descriptionPlaceholder: '可选，补充说明数据源用途',
      active: '启用',
      wideTable: '宽表管理',
      wideTableData: '宽表数据',
      manualUpdate: '手动更新数据',
      prevPage: '上一页',
      nextPage: '下一页',
    },
    templates: {
      title: '模板管理',
      createTemplate: '创建模板',
      uploadTemplate: '上传模板',
      noTemplates: '暂无模板',
      createFirstTemplate: '创建第一个模板',
      templateName: '模板名称',
      type: '类型',
      status: '状态',
      public: '公开',
      private: '私有',
      active: '活跃',
      inactive: '非活跃',
      actions: '操作',
      edit: '编辑',
      delete: '删除',
      duplicate: '复制',
      download: '下载',
      preview: '预览',
      created: '创建时间',
      updated: '更新时间',
      fileUpload: '文件上传',
      selectFile: '选择文件',
      uploadSuccess: '上传成功',
      uploadFailed: '上传失败',
      fileTypeError: '请选择 .docx 文件',
      nameRequired: '模板名称是必填项',
      descriptionPlaceholder: '请输入模板描述',
      namePlaceholder: '请输入模板名称',
    },
    tasks: {
      title: '任务管理',
      description: '管理您的报告生成任务',
      createTask: '创建任务',
      createTaskDescription: '创建新的报告生成任务',
      noTasks: '暂无任务',
      createFirstTask: '创建第一个任务',
      taskName: '任务名称',
      taskNamePlaceholder: '请输入任务名称',
      taskDescriptionPlaceholder: '请输入任务描述',
      template: '模板',
      dataSource: '数据源',
      status: '状态',
      active: '活跃',
      inactive: '非活跃',
      running: '运行中',
      completed: '已完成',
      failed: '失败',
      actions: '操作',
      edit: '编辑',
      delete: '删除',
      run: '运行',
      stop: '停止',
      pause: '暂停',
      resume: '恢复',
      view: '查看',
      schedule: '调度',
      scheduleType: '调度类型',
      scheduleConfig: '调度配置',
      scheduleConfigPlaceholder: '请输入调度配置',
      lastRun: '最后运行',
      nextRun: '下次运行',
      created: '创建时间',
      updated: '更新时间',
      selectTemplate: '选择模板',
      selectDataSource: '选择数据源',
      taskDetails: '任务详情',
      taskDetailsDescription: '配置任务的基本信息和调度设置',
      manual: '手动',
      manualTip: '该任务需手动启动，不会自动调度',
      startTask: '启动任务',
      daily: '每日',
      weekly: '每周',
      monthly: '每月',
      creating: '创建中',
      back: '返回',
      confirmDelete: '确认删除此任务？',
      taskNotFound: '任务未找到',
      backToTasks: '返回任务列表',
      executionHistory: '执行历史',
      never: '从未执行',
      notScheduled: '未安排',
      basicInformation: '基本信息',
      basicInformationDescription: '设置任务的基本信息和优先级',
      priority: '优先级',
      lowPriority: '低优先级',
      mediumPriority: '中优先级',
      highPriority: '高优先级',
      activeDescription: '启用后任务将按照调度设置自动执行',
      templateDescription: '选择用于生成报告的模板',
      dataSourceDescription: '选择任务将使用的数据源',
      dataSourceType: '数据源类型',
      scheduleSettings: '调度设置',
      scheduleSettingsDescription: '配置任务的执行时间和频率',
      notificationEnabled: '启用通知',
      notificationDescription: '任务执行完成后发送通知',
      dailyReport: '日报',
      weeklyReport: '周报',
      monthlyReport: '月报',
      nextDay: '次日',
      dailyTimeTip: '仅可选明天0:00-12:00',
      weeklyTimeTip: '仅可选下周一至三0:00-12:00',
      monthlyTimeTip: '仅可选下月1-15号0:00-12:00',
      weekday1: '周一',
      weekday2: '周二',
      weekday3: '周三',
      selectWeekday: '选择星期',
      selectDay: '选择日期',
      customConfig: '自定义表达式',
      customConfigPlaceholder: '请输入cron表达式，建议为次日及以后，周期前半段',
    },
    history: {
      title: '历史记录',
      description: '查看您的报告生成历史',
      noHistory: '暂无历史记录',
    },
    settings: {
      title: '设置',
      description: '管理您的账户设置和偏好',
      profile: '个人资料',
      notifications: '通知',
      preferences: '偏好设置',
      email: '邮箱配置',
      aiProvider: 'AI 提供商',
      security: '安全',
      save: '保存',
      cancel: '取消',
      loading: '加载中...',
      refresh: '刷新',
      confirm: '确认',
      updateProfile: '更新个人资料',
      updateNotifications: '更新通知设置',
      updatePreferences: '更新偏好设置',
      updateEmail: '更新邮箱设置',
      updateAIProvider: '更新AI提供商设置',
      updatePassword: '更新密码',
      testConnection: '测试连接',
      testing: '测试中...',
      fullName: '全名',
      fullNamePlaceholder: '请输入您的全名',
      bio: '个人简介',
      bioPlaceholder: '请介绍一下您自己',
      emailNotifications: '邮件通知',
      emailNotificationsDesc: '通过邮件接收通知',
      reportCompletion: '报告完成',
      reportCompletionDesc: '报告完成时获得通知',
      errorAlerts: '错误提醒',
      errorAlertsDesc: '获得错误和问题的通知',
      weeklySummary: '每周总结',
      weeklySummaryDesc: '接收每周总结报告',
      language: '语言',
      languageDesc: '选择您偏好的界面语言',
      theme: '主题',
      themeDesc: '选择您偏好的主题外观',
      dateFormat: '日期格式',
      dateFormatDesc: '选择您偏好的日期格式',
      timeFormat: '时间格式',
      timeFormatDesc: '选择您偏好的时间格式',
      smtpServer: 'SMTP 服务器',
      smtpPort: 'SMTP 端口',
      smtpUsername: 'SMTP 用户名',
      smtpPassword: 'SMTP 密码',
      useTLS: '使用 TLS',
      useTLSDesc: '启用 TLS 加密以确保安全的邮件传输',
      senderEmail: '发件人邮箱',
      senderName: '发件人姓名',
      currentPassword: '当前密码',
      currentPasswordPlaceholder: '请输入当前密码',
      newPassword: '新密码',
      newPasswordPlaceholder: '请输入新密码',
      confirmPassword: '确认新密码',
      confirmPasswordPlaceholder: '请确认新密码',
      provider: '提供商',
      providerPlaceholder: '选择提供商',
      apiKey: 'API 密钥',
      apiKeyPlaceholder: '请输入您的 API 密钥',
      apiUrl: 'API URL (可选)',
      apiUrlPlaceholder: 'https://api.openai.com/v1',
      modelName: '模型名称',
      modelNamePlaceholder: 'gpt-3.5-turbo',
      maxTokens: '最大令牌数',
      maxTokensPlaceholder: '1000',
      temperature: '温度',
      temperaturePlaceholder: '0.7',
      activeProvider: '活跃提供商',
      activeProviderDesc: '将此设置为活跃的 AI 提供商',
      saveSettings: '保存设置',
      testProvider: '测试提供商',
      updating: '更新中...',
    },
    user: {
      profile: '个人资料',
      settings: '设置',
      logout: '登出',
      account: '账户',
      preferences: '偏好设置',
      security: '安全',
      notifications: '通知',
      language: '语言',
      theme: '主题',
      help: '帮助',
      about: '关于',
    },
  },
  'en-US': {
    common: {
      loading: 'Loading...',
      error: 'Error',
      success: 'Success',
      cancel: 'Cancel',
      confirm: 'Confirm',
      save: 'Save',
      delete: 'Delete',
      edit: 'Edit',
      add: 'Add',
      search: 'Search',
      refresh: 'Refresh',
      back: 'Back',
      next: 'Next',
      previous: 'Previous',
      submit: 'Submit',
      reset: 'Reset',
      close: 'Close',
      open: 'Open',
      yes: 'Yes',
      no: 'No',
      ok: 'OK',
      navigation: 'Navigation',
      mainNavigation: 'Main Navigation',
      collapseSidebar: 'Collapse Sidebar',
      expandSidebar: 'Expand Sidebar',
      closeSidebar: 'Close Sidebar',
      openSidebar: 'Open Sidebar',
      dragToResize: 'Drag to resize',
      notifications: 'Notifications',
    },
    dashboard: {
      title: 'Dashboard Overview',
      description: 'Welcome back! Here is your report generation status.',
      totalReports: 'Total Reports',
      dataSources: 'Data Sources',
      templates: 'Templates',
      activeTasks: 'Active Tasks',
      createTask: 'Create Task',
      recentActivity: 'Recent Activity',
      systemStatus: 'System Status',
      backendService: 'Backend Service Normal',
      aiService: 'AI Service Normal',
      databaseConnection: 'Database Connection Normal',
    },
    auth: {
      login: 'Login',
      register: 'Register',
      logout: 'Logout',
      username: 'Username',
      password: 'Password',
      email: 'Email',
      forgotPassword: 'Forgot Password?',
      rememberMe: 'Remember Me',
      loginButton: 'Login',
      registerButton: 'Register',
      loginFailed: 'Login Failed',
      invalidCredentials: 'Invalid username or password',
      loggingIn: 'Logging in...',
      title: 'Login to AutoReportAI',
      description: 'Enter your credentials to continue',
      usernamePlaceholder: 'Enter username',
      passwordPlaceholder: 'Enter password',
      noAccount: "Don't have an account?",
      signUp: 'Sign up now',
      devHint: 'Development Environment Hint',
      defaultCredentials: 'Default: admin / admin123',
    },
    dataSources: {
      title: 'Data Sources',
      description: 'Manage your data source configurations',
      addDataSource: 'Add Data Source',
      name: 'Name',
      type: 'Type',
      configuration: 'Configuration',
      actions: 'Actions',
      test: 'Test',
      preview: 'Preview',
      edit: 'Edit',
      delete: 'Delete',
      noDataSources: 'No data sources found',
      createFirstDataSource: 'Create your first data source',
      createDataSource: 'Create Data Source',
      dataSourceName: 'Data Source Name',
      dataSourceNamePlaceholder: 'Enter data source name',
      dataSourceType: 'Data Source Type',
      database: 'Database',
      api: 'API',
      file: 'File',
      databaseUrl: 'Database URL',
      databaseUrlPlaceholder: 'Enter database connection URL',
      apiUrl: 'API URL',
      apiUrlPlaceholder: 'Enter API URL',
      filePath: 'File Path',
      filePathPlaceholder: 'Enter file path',
      descriptionPlaceholder: 'Optional, describe the data source',
      active: 'Active',
      wideTable: 'Wide Table',
      wideTableData: 'Wide Table Data',
      manualUpdate: 'Manual Update',
      prevPage: 'Prev',
      nextPage: 'Next',
    },
    templates: {
      title: 'Templates',
      description: 'Manage your report templates',
      createTemplate: 'Create Template',
      uploadTemplate: 'Upload Template',
      noTemplates: 'No templates found',
      createFirstTemplate: 'Create your first template',
      templateName: 'Template Name',
      type: 'Type',
      status: 'Status',
      public: 'Public',
      private: 'Private',
      active: 'Active',
      inactive: 'Inactive',
      actions: 'Actions',
      edit: 'Edit',
      delete: 'Delete',
      duplicate: 'Duplicate',
      download: 'Download',
      preview: 'Preview',
      created: 'Created',
      updated: 'Updated',
      fileUpload: 'File Upload',
      selectFile: 'Select File',
      uploadSuccess: 'Upload successful',
      uploadFailed: 'Upload failed',
      fileTypeError: 'Please select a .docx file',
      nameRequired: 'Template name is required',
      descriptionPlaceholder: 'Enter template description',
      namePlaceholder: 'Enter template name',
    },
    tasks: {
      title: 'Tasks',
      description: 'Manage your report generation tasks',
      createTask: 'Create Task',
      createTaskDescription: 'Create a new report generation task',
      noTasks: 'No tasks found',
      createFirstTask: 'Create your first task',
      taskName: 'Task Name',
      taskNamePlaceholder: 'Enter task name',
      taskDescriptionPlaceholder: 'Enter task description',
      template: 'Template',
      dataSource: 'Data Source',
      status: 'Status',
      active: 'Active',
      inactive: 'Inactive',
      running: 'Running',
      completed: 'Completed',
      failed: 'Failed',
      actions: 'Actions',
      edit: 'Edit',
      delete: 'Delete',
      run: 'Run',
      stop: 'Stop',
      pause: 'Pause',
      resume: 'Resume',
      view: 'View',
      schedule: 'Schedule',
      scheduleType: 'Schedule Type',
      scheduleConfig: 'Schedule Config',
      scheduleConfigPlaceholder: 'Enter schedule config',
      lastRun: 'Last Run',
      nextRun: 'Next Run',
      created: 'Created',
      updated: 'Updated',
      selectTemplate: 'Select template',
      selectDataSource: 'Select data source',
      taskDetails: 'Task Details',
      taskDetailsDescription: 'Configure basic task information and scheduling settings',
      manual: 'Manual',
      manualTip: 'This task must be started manually and will not be scheduled automatically',
      startTask: 'Start Task',
      daily: 'Daily',
      weekly: 'Weekly',
      monthly: 'Monthly',
      creating: 'Creating',
      back: 'Back',
      confirmDelete: 'Confirm delete this task?',
      taskNotFound: 'Task not found',
      backToTasks: 'Back to tasks list',
      executionHistory: 'Execution History',
      never: 'Never executed',
      notScheduled: 'Not scheduled',
      basicInformation: 'Basic Information',
      basicInformationDescription: 'Set basic task information and priority',
      priority: 'Priority',
      lowPriority: 'Low Priority',
      mediumPriority: 'Medium Priority',
      highPriority: 'High Priority',
      activeDescription: 'Enable automatic task execution according to schedule settings',
      templateDescription: 'Select template for report generation',
      dataSourceDescription: 'Select data source for the task',
      dataSourceType: 'Data Source Type',
      scheduleSettings: 'Schedule Settings',
      scheduleSettingsDescription: 'Configure task execution time and frequency',
      notificationEnabled: 'Enable Notifications',
      notificationDescription: 'Send notifications when task execution is completed',
      dailyReport: 'Daily Report',
      weeklyReport: 'Weekly Report',
      monthlyReport: 'Monthly Report',
      nextDay: 'Next Day',
      dailyTimeTip: 'Only next day 0:00-12:00 allowed',
      weeklyTimeTip: 'Only next Mon-Wed 0:00-12:00 allowed',
      monthlyTimeTip: 'Only next month 1-15th 0:00-12:00 allowed',
      weekday1: 'Monday',
      weekday2: 'Tuesday',
      weekday3: 'Wednesday',
      selectWeekday: 'Select Weekday',
      selectDay: 'Select Day',
      customConfig: 'Custom Expression',
      customConfigPlaceholder: 'Enter cron expression, suggest next day or earlier half of period',
    },
    history: {
      title: 'History',
      description: 'View your report generation history',
      noHistory: 'No history found',
    },
    settings: {
      title: 'Settings',
      description: 'Manage your account settings and preferences',
      profile: 'Profile',
      notifications: 'Notifications',
      preferences: 'Preferences',
      email: 'Email Configuration',
      aiProvider: 'AI Provider',
      security: 'Security',
      save: 'Save',
      cancel: 'Cancel',
      loading: 'Loading...',
      refresh: 'Refresh',
      confirm: 'Confirm',
      updateProfile: 'Update Profile',
      updateNotifications: 'Update Notifications',
      updatePreferences: 'Update Preferences',
      updateEmail: 'Update Email',
      updateAIProvider: 'Update AI Provider',
      updatePassword: 'Update Password',
      testConnection: 'Test Connection',
      testing: 'Testing...',
      fullName: 'Full Name',
      fullNamePlaceholder: 'Enter your full name',
      bio: 'Bio',
      bioPlaceholder: 'Tell us about yourself',
      emailNotifications: 'Email Notifications',
      emailNotificationsDesc: 'Receive notifications via email',
      reportCompletion: 'Report Completion',
      reportCompletionDesc: 'Get notified when reports are completed',
      errorAlerts: 'Error Alerts',
      errorAlertsDesc: 'Get notified about errors and issues',
      weeklySummary: 'Weekly Summary',
      weeklySummaryDesc: 'Receive weekly summary reports',
      language: 'Language',
      languageDesc: 'Choose your preferred language for the interface',
      theme: 'Theme',
      themeDesc: 'Choose your preferred theme appearance',
      dateFormat: 'Date Format',
      dateFormatDesc: 'Choose your preferred date format',
      timeFormat: 'Time Format',
      timeFormatDesc: 'Choose your preferred time format',
      smtpServer: 'SMTP Server',
      smtpPort: 'SMTP Port',
      smtpUsername: 'SMTP Username',
      smtpPassword: 'SMTP Password',
      useTLS: 'Use TLS',
      useTLSDesc: 'Enable TLS encryption for secure email transmission',
      senderEmail: 'Sender Email',
      senderName: 'Sender Name',
      currentPassword: 'Current Password',
      currentPasswordPlaceholder: 'Enter current password',
      newPassword: 'New Password',
      newPasswordPlaceholder: 'Enter new password',
      confirmPassword: 'Confirm New Password',
      confirmPasswordPlaceholder: 'Confirm new password',
      provider: 'Provider',
      providerPlaceholder: 'Select a provider',
      apiKey: 'API Key',
      apiKeyPlaceholder: 'Enter your API key',
      apiUrl: 'API URL (Optional)',
      apiUrlPlaceholder: 'https://api.openai.com/v1',
      modelName: 'Model Name',
      modelNamePlaceholder: 'gpt-3.5-turbo',
      maxTokens: 'Max Tokens',
      maxTokensPlaceholder: '1000',
      temperature: 'Temperature',
      temperaturePlaceholder: '0.7',
      activeProvider: 'Active Provider',
      activeProviderDesc: 'Set this as the active AI provider',
      saveSettings: 'Save Settings',
      testProvider: 'Test Provider',
      updating: 'Updating...',
    },
    user: {
      profile: 'Profile',
      settings: 'Settings',
      logout: 'Logout',
      account: 'Account',
      preferences: 'Preferences',
      security: 'Security',
      notifications: 'Notifications',
      language: 'Language',
      theme: 'Theme',
      help: 'Help',
      about: 'About',
    },
  },
}

type SupportedLocale = 'zh-CN' | 'en-US'

interface I18nContextType {
  t: (key: string, namespace?: string) => string
  currentLocale: SupportedLocale
  setLocale: (locale: SupportedLocale) => void
  isLoading: boolean
}

const I18nContext = createContext<I18nContextType | undefined>(undefined)

interface I18nProviderProps {
  children: ReactNode
  initialLocale?: SupportedLocale
}

export function I18nProvider({ children, initialLocale = 'zh-CN' }: I18nProviderProps) {
  const [currentLocale, setCurrentLocale] = useState<SupportedLocale>(initialLocale)
  const [isLoading, setIsLoading] = useState(false)

  const t = (key: string, namespace: string = 'common') => {
    const localeData = translations[currentLocale]
    const namespaceData = localeData?.[namespace as keyof typeof localeData]
    
    if (namespaceData && typeof namespaceData === 'object') {
      const value = (namespaceData as Record<string, string>)[key]
      if (value) return value
    }
    
    // Fallback to common namespace
    const commonData = localeData?.common
    if (commonData && typeof commonData === 'object') {
      const value = (commonData as Record<string, string>)[key]
      if (value) return value
    }
    
    // Fallback to key itself
    return key
  }

  const handleSetLocale = (locale: SupportedLocale) => {
    setIsLoading(true)
    setCurrentLocale(locale)
    // Simulate loading
    setTimeout(() => setIsLoading(false), 100)
  }

  const value: I18nContextType = {
    t,
    currentLocale,
    setLocale: handleSetLocale,
    isLoading,
  }

  return (
    <I18nContext.Provider value={value}>
      {children}
    </I18nContext.Provider>
  )
}

export function useI18n() {
  const context = useContext(I18nContext)
  if (!context) {
    throw new Error('useI18n must be used within an I18nProvider')
  }
  return context
} 